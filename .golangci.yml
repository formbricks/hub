# golangci-lint v2 configuration
# Run: make lint (requires make install-tools)
# See: https://golangci-lint.run/docs/configuration/

version: "2"

run:
  timeout: 5m
  concurrency: 4
  modules-download-mode: readonly
  go: "1.25"

output:
  formats:
    text:
      path: stdout
      colors: true
      print-issued-lines: true
      print-linter-name: true
  sort-order: ["linter", "file"]

# Linters: errcheck ensures returned errors are always handled (no silent ignoring).
linters:
  default: none
  enable:
    - bodyclose     # HTTP response bodies must be closed (resource leaks)
    - errcheck      # must use returned errors
    - gocritic      # error handling and style
    - govet         # standard go vet
    - gosec         # security (SQL injection, secrets, weak crypto, etc.)
    - ineffassign   # ineffective assignments
    - modernize     # prefer modern Go (e.g. any instead of interface{})
    - noctx         # HTTP/DB calls should use context (timeouts, cancellation)
    - perfsprint    # prefer faster alternatives to fmt.Sprintf where possible
    - rowserrcheck # Rows.Err must be checked after iterating
    - sqlclosecheck # sql.Rows/Stmt must be closed
    - staticcheck   # static analysis
    - unused        # unused code
    - revive        # fast, configurable
  exclusions:
    rules:
      # internal/errors is intentionally named for domain errors; conflicts with stdlib "errors" package name
      - path: internal/errors
        linters:
          - revive
      # tests often use http.Get/Post/NewRequest for brevity; production code still must use context
      - path: _test\.go$
        linters:
          - noctx
  settings:
    errcheck:
      check-blank: true           # report when error discarded with _
      check-type-assertions: true # report unchecked type assertions
    gocritic:
      enabled-tags:
        - diagnostic
        - style
        - performance
      disabled-checks:
        - hugeParam  # often too noisy for large structs
