"use strict";(globalThis.webpackChunk_formbricks_docs=globalThis.webpackChunk_formbricks_docs||[]).push([[842],{17497:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"core-concepts/authentication","title":"Authentication","description":"Secure your Hub API with optional API key authentication. Enable it in production with a single environment variable.","source":"@site/docs/core-concepts/authentication.md","sourceDirName":"core-concepts","slug":"/core-concepts/authentication","permalink":"/core-concepts/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/formbricks/hub/tree/main/apps/docs/docs/core-concepts/authentication.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Data Model","permalink":"/core-concepts/data-model"},"next":{"title":"Webhooks","permalink":"/core-concepts/webhooks"}}');var r=i(25270),l=i(37678);const t={sidebar_position:2},c="Authentication",a={},o=[{value:"How It Works",id:"how-it-works",level:2},{value:"Enabling API Key Authentication",id:"enabling-api-key-authentication",level:2},{value:"1. Set Environment Variable",id:"1-set-environment-variable",level:3},{value:"2. Restart the Service",id:"2-restart-the-service",level:3},{value:"3. Include Key in Requests",id:"3-include-key-in-requests",level:3},{value:"Protected Endpoints",id:"protected-endpoints",level:2},{value:"Authentication Workflow",id:"authentication-workflow",level:2},{value:"Request Flow",id:"request-flow",level:3},{value:"Example Requests",id:"example-requests",level:3},{value:"Production Deployment",id:"production-deployment",level:2},{value:"Docker Deployment with Auth",id:"docker-deployment-with-auth",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"1. Use HTTPS in Production",id:"1-use-https-in-production",level:3},{value:"2. Store Keys Securely",id:"2-store-keys-securely",level:3},{value:"3. Rotate Keys Regularly",id:"3-rotate-keys-regularly",level:3},{value:"4. Monitor for Unauthorized Access",id:"4-monitor-for-unauthorized-access",level:3},{value:"5. Rate Limiting",id:"5-rate-limiting",level:3},{value:"Disabling Authentication",id:"disabling-authentication",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"401 Unauthorized Error",id:"401-unauthorized-error",level:3},{value:"Health Check Returns 401",id:"health-check-returns-401",level:3},{value:"Docs Page Returns 401",id:"docs-page-returns-401",level:3},{value:"Examples",id:"examples",level:2},{value:"cURL",id:"curl",level:3},{value:"JavaScript (Node.js)",id:"javascript-nodejs",level:3},{value:"Python",id:"python",level:3},{value:"Go",id:"go",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,r.jsx)(n.p,{children:"Secure your Hub API with optional API key authentication. Enable it in production with a single environment variable."}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(n.p,{children:["Hub runs ",(0,r.jsx)(n.strong,{children:"without authentication by default"})," for easy local development. When you set ",(0,r.jsx)(n.code,{children:"SERVICE_API_KEY"}),", all API endpoints require the ",(0,r.jsx)(n.code,{children:"X-API-Key"})," header - except health checks and documentation, which remain public."]}),"\n",(0,r.jsx)(n.h2,{id:"enabling-api-key-authentication",children:"Enabling API Key Authentication"}),"\n",(0,r.jsx)(n.h3,{id:"1-set-environment-variable",children:"1. Set Environment Variable"}),"\n",(0,r.jsxs)(n.p,{children:["Add ",(0,r.jsx)(n.code,{children:"SERVICE_API_KEY"})," to your ",(0,r.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"SERVICE_API_KEY=your-secret-key-here\n"})}),"\n",(0,r.jsxs)(n.admonition,{title:"Generating Secure Keys",type:"tip",children:[(0,r.jsx)(n.p,{children:"Generate a cryptographically secure key:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# macOS/Linux\nopenssl rand -base64 32\n\n# Or use a password manager's random generator\n"})})]}),"\n",(0,r.jsx)(n.h3,{id:"2-restart-the-service",children:"2. Restart the Service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Stop the service (Ctrl+C)\n# Then restart:\nmake dev\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see in the logs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2139\ufe0f  API key authentication enabled\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-include-key-in-requests",children:"3. Include Key in Requests"}),"\n",(0,r.jsxs)(n.p,{children:["All API requests (except ",(0,r.jsx)(n.code,{children:"/health"})," and ",(0,r.jsx)(n.code,{children:"/docs"}),") now require the ",(0,r.jsx)(n.code,{children:"X-API-Key"})," header:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "X-API-Key: your-secret-key-here" \\\n  http://localhost:8080/v1/experiences\n'})}),"\n",(0,r.jsx)(n.h2,{id:"protected-endpoints",children:"Protected Endpoints"}),"\n",(0,r.jsx)(n.p,{children:"When API key auth is enabled, these endpoints require authentication:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /v1/experiences"})," - Create experience"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /v1/experiences"})," - List experiences"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /v1/experiences/{id}"})," - Get experience"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"PATCH /v1/experiences/{id}"})," - Update experience"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DELETE /v1/experiences/{id}"})," - Delete experience"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /v1/experiences/search"})," - Semantic search"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Always public"})," (no auth required):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /health"})," - Health check"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /docs"})," - API documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /openapi.json"})," - OpenAPI spec"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"authentication-workflow",children:"Authentication Workflow"}),"\n",(0,r.jsx)(n.h3,{id:"request-flow",children:"Request Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mermaid",children:"graph TD\n    A[Client Request] --\x3e B{Has X-API-Key?}\n    B --\x3e|No| C[401 Unauthorized]\n    B --\x3e|Yes| D{Key Matches?}\n    D --\x3e|No| E[401 Unauthorized]\n    D --\x3e|Yes| F[Process Request]\n    F --\x3e G[200 Success]\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-requests",children:"Example Requests"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Without authentication (enabled):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8080/v1/experiences\n"})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "title": "Unauthorized",\n  "status": 401,\n  "detail": "Missing or invalid API key"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"With authentication:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "X-API-Key: your-secret-key-here" \\\n  http://localhost:8080/v1/experiences\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "data": [...],\n  "total": 10,\n  ...\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"production-deployment",children:"Production Deployment"}),"\n",(0,r.jsx)(n.p,{children:"Hub's built-in API key authentication is ideal for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Internal services and tools"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Server-to-server communication"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Quick production deployments"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For public APIs or multi-tenant systems, consider deploying behind an API gateway (AWS API Gateway, Kong, Traefik) for advanced features like OAuth, JWT, or per-user access control."}),"\n",(0,r.jsx)(n.h3,{id:"docker-deployment-with-auth",children:"Docker Deployment with Auth"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  -p 8080:8080 \\\n  -e SERVICE_DATABASE_URL=postgres://... \\\n  -e SERVICE_API_KEY=your-secret-key-here \\\n  ghcr.io/formbricks/hub:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Required\nSERVICE_DATABASE_URL=postgres://user:pass@host/db\n\n# Optional (but recommended for production)\nSERVICE_API_KEY=your-secret-key-here\nSERVICE_LOG_LEVEL=info\nSERVICE_ENVIRONMENT=production\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"../reference/environment-variables",children:"See full environment variable reference \u2192"})}),"\n",(0,r.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-use-https-in-production",children:"1. Use HTTPS in Production"}),"\n",(0,r.jsx)(n.p,{children:"Always use HTTPS to encrypt API keys in transit:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u274c http://api.example.com  (insecure)\n\u2705 https://api.example.com (secure)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-store-keys-securely",children:"2. Store Keys Securely"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u2705 Good practices:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use environment variables (not hardcoded)"}),"\n",(0,r.jsx)(n.li,{children:"Store in secret management (AWS Secrets Manager, HashiCorp Vault)"}),"\n",(0,r.jsx)(n.li,{children:"Rotate keys regularly"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u274c Avoid:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Committing keys to Git"}),"\n",(0,r.jsx)(n.li,{children:"Sharing keys via email/Slack"}),"\n",(0,r.jsx)(n.li,{children:"Using the same key for dev and prod"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-rotate-keys-regularly",children:"3. Rotate Keys Regularly"}),"\n",(0,r.jsx)(n.p,{children:"Schedule regular key rotation (e.g., every 90 days):"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Generate new key"}),"\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"SERVICE_API_KEY"})," in production"]}),"\n",(0,r.jsx)(n.li,{children:"Restart service"}),"\n",(0,r.jsx)(n.li,{children:"Update clients with new key"}),"\n",(0,r.jsx)(n.li,{children:"Revoke old key"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-monitor-for-unauthorized-access",children:"4. Monitor for Unauthorized Access"}),"\n",(0,r.jsx)(n.p,{children:"Enable structured logging to track failed auth attempts:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"SERVICE_LOG_LEVEL=info\n"})}),"\n",(0,r.jsx)(n.p,{children:"Look for 401 responses in logs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "level": "warn",\n  "msg": "unauthorized request",\n  "path": "/v1/experiences",\n  "ip": "203.0.113.1"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"5-rate-limiting",children:"5. Rate Limiting"}),"\n",(0,r.jsx)(n.p,{children:"Hub includes built-in rate limiting to protect against abuse:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Per-IP limits"}),": Default 100 requests/second per IP address"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Global limits"}),": Default 1000 requests/second across all IPs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configurable"}),": Adjust via ",(0,r.jsx)(n.code,{children:"SERVICE_RATE_LIMIT_*"})," environment variables"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"../reference/environment-variables#rate-limiting",children:"Learn more about rate limiting configuration \u2192"})}),"\n",(0,r.jsx)(n.h2,{id:"disabling-authentication",children:"Disabling Authentication"}),"\n",(0,r.jsx)(n.p,{children:"To disable auth for local development:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Remove or comment out ",(0,r.jsx)(n.code,{children:"SERVICE_API_KEY"})," in ",(0,r.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# SERVICE_API_KEY=your-key\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Restart:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make dev\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Logs will show:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u2139\ufe0f  API key authentication disabled\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"401-unauthorized-error",children:"401 Unauthorized Error"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "title": "Unauthorized",\n  "status": 401,\n  "detail": "Missing or invalid API key"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check if auth is enabled:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"grep SERVICE_API_KEY .env\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Verify header syntax:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Correct\ncurl -H "X-API-Key: your-key" http://...\n\n# Wrong (lowercase \'k\')\ncurl -H "X-API-key: your-key" http://...\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Check key matches ",(0,r.jsx)(n.code,{children:".env"}),":"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo $SERVICE_API_KEY\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"health-check-returns-401",children:"Health Check Returns 401"}),"\n",(0,r.jsxs)(n.p,{children:["Health checks (",(0,r.jsx)(n.code,{children:"/health"}),") should ",(0,r.jsx)(n.strong,{children:"never"})," require auth."]}),"\n",(0,r.jsxs)(n.p,{children:["If you see this, it's a bug. Please ",(0,r.jsx)(n.a,{href:"https://github.com/formbricks/hub/issues",children:"report it"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"docs-page-returns-401",children:"Docs Page Returns 401"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"/docs"})," endpoint should always be public."]}),"\n",(0,r.jsxs)(n.p,{children:["If you see this, it's a bug. Please ",(0,r.jsx)(n.a,{href:"https://github.com/formbricks/hub/issues",children:"report it"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.h3,{id:"curl",children:"cURL"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "X-API-Key: abc123" \\\n  -X POST http://localhost:8080/v1/experiences \\\n  -H "Content-Type: application/json" \\\n  -d \'{"source_type":"survey",...}\'\n'})}),"\n",(0,r.jsx)(n.h3,{id:"javascript-nodejs",children:"JavaScript (Node.js)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const response = await fetch('http://localhost:8080/v1/experiences', {\n  headers: {\n    'X-API-Key': 'abc123',\n    'Content-Type': 'application/json',\n  },\n  method: 'POST',\n  body: JSON.stringify({\n    source_type: 'survey',\n    field_id: 'q1',\n    field_type: 'text',\n    value_text: 'Great!',\n  }),\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import requests\n\nheaders = {\n    'X-API-Key': 'abc123',\n    'Content-Type': 'application/json',\n}\n\nresponse = requests.get(\n    'http://localhost:8080/v1/experiences',\n    headers=headers\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"go",children:"Go"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'client := &http.Client{}\nreq, _ := http.NewRequest("GET", "http://localhost:8080/v1/experiences", nil)\nreq.Header.Set("X-API-Key", "abc123")\n\nresp, err := client.Do(req)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./webhooks",children:"Webhooks"})," - React to data changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../api-reference",children:"API Reference"})," - Explore endpoints"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../reference/environment-variables",children:"Environment Variables"})," - Configuration reference"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},37678:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(39430);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);