---
title: "Environment Variables"
description: "Complete reference for configuring Formbricks Hub via environment variables."
---

## Required Variables

### `API_KEY`

API key for authentication. All API requests (except `/health` and `/docs`) require the `Authorization: Bearer <token>` header.

**Example:**

```bash
API_KEY=your-secret-api-key-here
```

**Default:** None (required)

**Usage:**

```bash
curl -H "Authorization: Bearer your-secret-key-here" \
  http://localhost:8080/v1/feedback-records
```

[Learn more about authentication →](/core-concepts/authentication)

---

## Database Configuration

### `DATABASE_URL`

PostgreSQL connection string.

**Format:**

```
postgres://[user]:[password]@[host]:[port]/[database]?[params]
```

**Examples:**

```bash
# Local development
DATABASE_URL=postgres://postgres:postgres@localhost:5432/hub_dev?sslmode=disable

# Production with SSL
DATABASE_URL=postgres://user:pass@db.example.com:5432/hub_prod?sslmode=require
```

**Default:** `postgres://postgres:postgres@localhost:5432/test_db?sslmode=disable`

---

### `DATABASE_MAX_CONNS`

Maximum number of connections in the pool. Size the pool for your expected concurrency and DB limits.

**Default:** `25`

---

### `DATABASE_MIN_CONNS`

Minimum number of connections to keep open. Use `0` to avoid idle connections; use a small positive value to reduce latency for the first requests after idle.

**Default:** `0`

---

### `DATABASE_MAX_CONN_LIFETIME_SECONDS`

Maximum lifetime of a connection in seconds before it is closed and replaced. Helps avoid long-lived connections that may be closed by the server or network.

**Default:** `3600` (1 hour)

---

## Server Configuration

### `PORT`

Port for the HTTP server.

**Examples:**

```bash
PORT=8080  # Default
PORT=3000  # Custom port
```

**Default:** `8080`

---

## Request limits

### `MAX_REQUEST_BODY_BYTES`

Maximum size of the request body in bytes (global limit for all endpoints). Requests whose body exceeds this limit receive `413 Request Entity Too Large`. Helps prevent OOM and DoS from oversized payloads.

**Default:** `10485760` (10 MiB)

---

## Logging

### `LOG_LEVEL`

Logging verbosity level.

**Options:**

- `debug` - Detailed debugging information
- `info` - General informational messages (recommended)
- `warn` - Warning messages only
- `error` - Error messages only

**Examples:**

```bash
LOG_LEVEL=debug  # Development
LOG_LEVEL=info   # Production (recommended)
LOG_LEVEL=warn   # Quiet production
```

**Default:** `info`

---

## Webhooks and event pipeline

These variables control the in-memory event channel, webhook delivery, and graceful shutdown. See [Event pipeline](/reference/event-pipeline) for behavior when the channel is full and River queue semantics.

### `MESSAGE_PUBLISHER_QUEUE_MAX_SIZE`

Event channel capacity. When full, new events are dropped (non-blocking); the API still returns success. Increase if you see `hub_events_discarded_total` increasing.

**Default:** `16384`

---

### `MESSAGE_PUBLISHER_PER_EVENT_TIMEOUT_SECONDS`

Maximum time in seconds to process one event across all providers (e.g. webhook enqueue). Limits how long the single worker can block before reading the next event from the channel.

**Default:** `10`

---

### `WEBHOOK_DELIVERY_MAX_CONCURRENT`

Maximum concurrent webhook HTTP deliveries (River default queue workers).

**Default:** `100`

---

### `WEBHOOK_DELIVERY_MAX_ATTEMPTS`

Maximum River job attempts per webhook delivery before the webhook is disabled.

**Default:** `3`

---

### `WEBHOOK_MAX_FAN_OUT_PER_EVENT`

Maximum webhook jobs enqueued per event in one InsertMany batch (events with more subscribers use multiple batches).

**Default:** `500`

---

### `WEBHOOK_ENQUEUE_MAX_RETRIES`

Number of retries when enqueueing webhook jobs to River fails (e.g. transient DB error). Total attempts = 1 + this value. Each retry uses exponential backoff with jitter. Set to `0` to disable retries.

**Default:** `3`

---

### `WEBHOOK_ENQUEUE_INITIAL_BACKOFF_MS`

Initial backoff in milliseconds after the first enqueue failure. Backoff doubles each attempt, capped by `WEBHOOK_ENQUEUE_MAX_BACKOFF_MS`. Jitter is applied to avoid thundering herd. With defaults (500, 5000, 3 retries), total wait before failing is about 3.5 seconds.

**Default:** `500`

---

### `WEBHOOK_ENQUEUE_MAX_BACKOFF_MS`

Maximum backoff in milliseconds between enqueue retries.

**Default:** `5000`

---

### `WEBHOOK_MAX_COUNT`

Maximum total webhooks allowed; creation returns 403 when count reaches this limit.

**Default:** `500`

---

### `WEBHOOK_CACHE_SIZE`

Max entries for webhook caches (shared by the list-by-event-type cache and the GetByID cache). Increase if you have many event types or many webhooks and want more cache capacity.

**Default:** `4096`

---

### `SHUTDOWN_TIMEOUT_SECONDS`

Graceful shutdown timeout for the HTTP server and River. The event channel is drained before River stops.

**Default:** `30`

---

## Observability

When these variables are empty or unset, the corresponding feature is disabled and a startup warning is logged (e.g. "metrics not enabled", "tracing not enabled"). See [Metrics and Observability](/reference/metrics) for full details.

### `OTEL_METRICS_EXPORTER`

Set to `otlp` to enable metrics via OTLP push to the same endpoint as traces (`OTEL_EXPORTER_OTLP_ENDPOINT`). Empty or unset = metrics disabled.

**Example:**

```bash
OTEL_METRICS_EXPORTER=otlp
```

**Default:** Empty (metrics disabled)

---

### `OTEL_TRACES_EXPORTER`

Set to `otlp` or `stdout` to enable distributed tracing. Empty or unset = tracing disabled. When enabled, trace context (`trace_id`, `span_id`) and `request_id` are added to structured log records when the slog handler receives a context with an active span or request ID.

**Options:**

- `otlp` — Export traces via OTLP (e.g. to a collector). Optionally set `OTEL_EXPORTER_OTLP_ENDPOINT`.
- `stdout` — Print traces to stdout (useful for local development).

**Example:**

```bash
OTEL_TRACES_EXPORTER=otlp
# OTEL_EXPORTER_OTLP_ENDPOINT=https://localhost:4318  # optional
```

**Default:** Empty (tracing disabled)

---

### `OTEL_TRACES_SAMPLER`

Optional. When tracing is enabled, controls which traces are sampled. Use in production to reduce volume and cost (e.g. `parentbased_traceidratio` with `OTEL_TRACES_SAMPLER_ARG=0.1` for 10% sampling).

**Options:**

- `always_on` — Sample every trace (default behavior; high volume in production).
- `always_off` — Sample no traces.
- `traceidratio` — Sample a fraction of traces; set `OTEL_TRACES_SAMPLER_ARG` to a number between 0 and 1 (e.g. `0.1` for 10%).
- `parentbased_traceidratio` — Like traceidratio but respects parent sampling decision; set `OTEL_TRACES_SAMPLER_ARG` (e.g. `0.1`).
- `parentbased_always_on` — Same as default: sample when no parent or parent is sampled.
- `parentbased_always_off` — Do not sample root spans; follow parent otherwise.

**Default:** Empty (treated as `parentbased_always_on`)

---

### `OTEL_TRACES_SAMPLER_ARG`

Optional. Used when `OTEL_TRACES_SAMPLER` is `traceidratio` or `parentbased_traceidratio`. A number between 0 and 1 (e.g. `0.1` for 10% of traces). Invalid or missing is treated as 1.0 (sample all).

---

### `OTEL_EXPORTER_OTLP_ENDPOINT`

Optional. Base URL for the OTLP exporter when `OTEL_TRACES_EXPORTER=otlp` (e.g. `https://localhost:4318`). The path `/v1/traces` is appended by the client.

**Default:** Empty (exporter uses its default, e.g. localhost:4318)

---

## Complete Example: Development

```bash
# .env

# Authentication (required)
API_KEY=dev-secret-key

# Database
DATABASE_URL=postgres://postgres:postgres@localhost:5432/hub_dev?sslmode=disable

# Server
PORT=8080

# Logging
LOG_LEVEL=debug

# Optional: metrics and tracing
# OTEL_METRICS_EXPORTER=otlp
# OTEL_TRACES_EXPORTER=stdout
```

## Complete Example: Production

```bash
# Production environment variables

# Authentication (required)
API_KEY=your-cryptographically-secure-key-here

# Database
DATABASE_URL=postgres://prod_user:secure_password@db.production.com:5432/hub_prod?sslmode=require

# Server
PORT=8080

# Logging
LOG_LEVEL=info

# Optional: metrics and tracing (OTLP push to collector)
# OTEL_METRICS_EXPORTER=otlp
# OTEL_TRACES_EXPORTER=otlp
# OTEL_EXPORTER_OTLP_ENDPOINT=http://collector:4318
```

## Loading Environment Variables

### Using `.env` File

```bash
# Copy example
cp .env.example .env

# Edit with your values
vim .env

# Start the server (variables are automatically loaded)
make run
```

### Using Docker

```bash
docker run -d \
  -e API_KEY="your-key" \
  -e DATABASE_URL="postgres://..." \
  formbricks/hub:latest
```

### Using Docker Compose

```yaml
services:
  hub:
    image: formbricks/hub:latest
    environment:
      API_KEY: ${API_KEY}
      DATABASE_URL: ${DATABASE_URL}
      LOG_LEVEL: info
    env_file:
      - .env.production
```

## Troubleshooting

### "API_KEY environment variable is required" Error

**Problem:** Missing `API_KEY` environment variable.

**Solution:** Set the variable in your `.env` file:

```bash
API_KEY=your-secret-api-key-here
```

### "Cannot connect to database" Error

**Problem:** Database connection details are incorrect or database is not running.

**Solutions:**

1. Check PostgreSQL is running: `docker compose ps`
2. Verify connection string format
3. Test connection manually:
   ```bash
   psql "postgres://postgres:postgres@localhost:5432/hub_dev?sslmode=disable"
   ```

### API Key Not Working

**Problem:** Getting 401 errors despite setting `Authorization` header.

**Solutions:**

1. Verify `API_KEY` is set: `grep API_KEY .env`
2. Check header format is correct: `Authorization: Bearer <your-key>`
3. Ensure key matches exactly (no extra spaces)

## Next Steps

- [Authentication Guide](/core-concepts/authentication) - Secure your API
- [API Reference](/api-reference) - Explore endpoints
- [Architecture](/reference/architecture) - System design and components
